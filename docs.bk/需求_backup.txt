我准备为我的宿舍经济设计营销系统（控制台应用），使用nodejs+typescript，在树莓派运行。我需要以下功能
经营模式（独立程序）
 - 运行前提供已有顾客简称，后续操作基于该顾客进行；如需创建新顾客，输入“.”或"。"开头的命令，提供真实姓名、简称（唯一）
 - 调试模式下，所有操作展示商家利润
 - 现金购物：
  - 展示商品名、价格、促销活动（会员专享）
  - 顾客输入商品序号、数量，随后结算。不要购物车，每次只能买一个品种的商品。结算时，使用最优优惠，填写赊账金额、备注，展示顾客资产明细、应付金额
   - 新顾客需要
  - 结算后，输出订单信息和校验码，用于提供纸质手写小票
 - 积分商城（会员专享）
  - 展示商品名、价格
  - 顾客输入商品序号、数量，随后结算。结算时填写备注，展示资产明细、应付积分
 - 积分抽奖（会员专享）
  - 展示多个奖池、各个奖池的奖品（谢谢参与、积分、正在售卖的商品）及概率、每抽价格
  - 顾客输入奖池序号，输入大写 Y 抽奖，展示抽奖结果
管理模式（独立程序）
 - 商品看板：事先在json文件编辑商品信息。在这里展示库存、售价、成本、（本周、累计）+（顾客实付现金、商家利润、商品成本）、促销活动、本周收入等
 - 活动看板：
  - 事先在json文件编辑活动预算，积分商城商品，抽奖奖池、奖池内奖品、概率、每抽价格、促销活动模板等
  - 展示剩余活动预算，积分商城、积分抽奖的各个信息
 - 顾客看板：展示顾客信息
 - 资产管理：充/扣活动预算、顾客积分、顾客赊账，这些都需要填写原因
 - 库存管理：手动增减库存（需要填写说明，不创建订单）、上架新商品至现金购物/积分商城（需要填写：自定义字符串id,名字、价格、成本、初始库存、哪个货架（现金购物/积分商城）、促销活动模板）
 - 退款：输入订单号，输入退款商品数量（检查异常数值），输入退款原因，展示退款详情，输入大写 Y 确认退款

校验码算法：sha1("salt"+String(订单号、实付金额或积分、返利积分)).subString(4).toUpperCase()

完善以下数据结构
订单（属性：由日期、商品id、随机数构成的订单id,什么时候，谁，买了什么东西，花了多少现金，花了多少积分，返利了多少积分，手动操作的原因等）
退款订单（属性：由日期、商品id、随机数构成的退款订单id、原订单id,日期，实际，手动操作的原因等）
货架（用于展示已上架商品，不展示下架商品，属性：所有已上架的商品的 自定义字符串id等）
商品（可以通过花钱买、积分换、抽奖获得，属性有自定义字符串id,名字、价格、成本、参与的促销活动、库存（当前和初始）、优惠限制等）
顾客（属性：是否为会员、欠费金额、持有的积分，总消费额、本周消费额等）
促销活动模板（买x包送y元积分、买满x元送y积分）

营销活动
 - 1积分=1元，即等价于现实的金钱，但通过营销活动获得，且不可提现
 - 活动预算增加途径：手动在管理模式增加、顾客参与积分商城/抽奖时，商家的每抽利润；扣除途径：手动在管理模式扣除、用户中奖
 - 方便面买x袋送y积分,买更多（m）送更多（n），这里送的积分属于让利，不扣除活动预算；只有现金购物参与买就送，积分兑换不参与买就送；商品每周有优惠上限（优惠限前几袋）
 - 抽奖可设置新人首抽花特定数量积分、以及对顾客不可见的、调整后的奖池及概率
 - 本周消费满x元，送y天会员，已有会员则续期，有效期上限z天
 - 积分在会员过期后立即清空

特别说明

营销活动允许商家亏钱

顾客花钱买商品、花积分兑换商品，都属于售出商品；商家赚的金钱利润直接“进口袋”，积分利润（顾客实付积分-商品金钱成本）放入活动预算
“现金购物”、“积分商城”使用货架，积分抽奖单独维护奖池

7天内可退款/退积分；如花钱买的商品参与了买返活动，退款时扣除赠送的积分，积分不足时，直接将积分扣成负数，但扣成负数需要我确认，如果我认为将欠的积分太多，我可以手动拒绝退款
买就送订单拆分退款（如，买2退1,按以下公式扣除积分）：需扣除的积分 = (申请退款的包数 ÷ 购买总包数) × 获得的总积分， 应退款金额 = (申请退款的包数 ÷ 购买总包数) × 实付总金额 - 不足以扣除的积分（如有）

库存变动可通过现金购物、积分兑换、抽奖

为会员续期等场景计算顾客消费额时，不计入已退款订单；更新会员状态发现因为退款导致消费额不达标，则会员应该失效

我的规模小到每周只卖10单左右，且程序毕业就扔，因此性能不是大问题。降低算法复杂度，包括：
 - 除了订单历史和其他不可变数据，所有数据均尽可能基于订单历史现场计算，不单独为其他数据建立数据库
 - 数据库用json存储

供参考的商品/奖池示例

现金购物：
 - 方便面1包 进价1.3元 售价2元 买2包送0.5积分
 - 小包零食 进价0元，售价0.2元
 - 大包零食 进价0.4元，售价1元
积分兑换：
 - 方便面1包 进价1.3积分 售价1.75积分
 - 小包零食 进价0积分，售价0.2积分
 - 大包零食 进价0.4积分，售价1积分
奖池1，每抽 0.28积分；新人首抽 0.1，首抽时悄悄地移除奖励 小包零食，并将多出来的的概率分给 0.33 积分
 - 小包零食 65%
 - 0.33 积分 15%
 - 大包零食 10%
 - 0.5 积分 7%
 - 1 积分 3%
奖池2，每抽 1.18积分
 - 大包零食 90%
 - 2.88 积分 10%


---追加需求---


一种商品可以同时出现在多个货架，但共享库存；一个商品在不同货架售价可能不同，例如2元/1.75积分
订单历史添加成本字段，用于价格变动时准确计算之前的收入
为抽奖创建这样的订单：具有特殊商品id、备注直接写抽到的奖品名称；抽奖不可退款
后台管理模式里，加一个“一键导出欠债名单”的功能，导出欠债名单时，需要把每个欠债人的“最后消费时间”也导出来
活动预算增加途径：手动在管理模式增加、顾客参与积分商城/抽奖时，商家的每抽利润；扣除途径：手动在管理模式扣除、顾客中奖等；注意处理每抽商家盈亏问题，正确增减预算
会员积分为负时，会员过期不重置积分
赊账额允许为负数（我欠顾客钱），但下单前需要提示
订单号：prefix+年+月+日+时+分+秒+毫秒+2位随机数
活动预算：在后台单独添加功能，手动加减预算：需要单独记录到data/store_data.json budgetLogs；budgetLogs仅限记录**手动增减**，其他来源的预算通过历史订单现算
为单个顾客编辑积分/赊账，不计入活动预算，操作记录到其他日志
添加其他日志：适用于记录对 不依赖历史订单计算 的数据的更改记录，也是json