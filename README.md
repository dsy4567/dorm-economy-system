# 宿舍经济营销系统

一个基于 Node.js + TypeScript 开发的宿舍小卖部营销系统，专为树莓派部署设计。

## 项目概述

这是一个为宿舍小卖部设计的轻量级营销系统，包含经营模式和管理模式两个独立程序，支持现金购物、积分兑换、会员管理等功能。

## 功能特性

### 经营模式
- **顾客管理**：支持新顾客创建和现有顾客识别
- **现金购物**：商品展示、自动优惠计算、订单结算
- **积分商城**：会员专享积分兑换功能
- **实时统计**：会话期间累计实付现金统计

### 管理模式
- **商品看板**：商品信息、库存、销售数据展示
- **活动看板**：促销活动、预算管理
- **顾客看板**：顾客详细信息管理
- **资产管理**：积分、赊账、活动预算管理
- **库存管理**：商品上架、库存调整
- **退款功能**：支持部分退款和退款风控
- **校验码反查**：通过校验码查找订单信息

## 会员系统

### 会员等级
- **特殊用户 (SPECIAL)**：手动指定，享受特殊优惠
- **正式会员 (OFFICIAL)**：基于滑动窗口消费额自动获得
- **见习会员 (TRAINEE)**：默认等级，享受基础权益

### 积分体系
- 1积分 = 1元（等价现金，不可提现）
- 积分上限可配置（默认5积分）
- 积分不过期，支持积分兑换

## 技术栈

- **后端**：Node.js + TypeScript
- **部署**：树莓派
- **数据存储**：JSON文件
- **构建工具**：TypeScript编译器

## 快速开始

### 环境要求
- Node.js 20.0.0+
- TypeScript 5.0.0+

### 安装依赖
```bash
npm install
```

### 构建项目
```bash
npm run build
```

### 运行程序
```bash
# 运行主程序
npm start

# 开发模式（监听文件变化）
npm run watch

# 验证码生成器
npm run vc
```

## 项目结构

```
dorm-economy-system/
├── src/                    # 源代码目录
│   ├── main.ts            # 主程序入口
│   └── verify-code-generator.ts  # 验证码生成器
├── data/                  # 数据文件（敏感数据，不纳入版本控制）
├── data.example/          # 数据文件模板
├── schemas/               # JSON Schema定义
├── dist/                  # 构建输出目录
├── backups/               # 备份文件目录
└── docs/                  # 文档目录
```

## 数据文件说明

### 主要数据文件
- `config.json`：系统配置
- `member_config.json`：会员配置
- `products.json`：商品信息
- `promotions.json`：促销活动
- `store_data.json`：订单历史和其他日志
- `privacy_map.json`：隐私映射

### 数据备份
系统会自动创建数据备份，备份文件存储在 `backups/` 目录中。

## 配置说明

### 会员配置
在 `config.json` 中配置会员规则：
- `MEMBER.NEW_RULE.LOOKBACK_DAYS`：滑动窗口天数（默认21天）
- `MEMBER.NEW_RULE.TRIGGER_AMOUNT`：正式会员触发金额（默认13元）

### 积分配置
- `MAX_POINTS`：积分上限（默认5）

## 安全说明

- 敏感数据文件（`data/` 目录）已通过 `.gitignore` 排除
- 使用数据模板（`data.example/`）进行初始配置
- 定期备份重要数据

## 开发指南

### 代码规范
- 使用 TypeScript 进行类型安全开发
- 遵循项目中的代码结构和命名约定
- 修改代码后及时更新文档

### 数据操作原则
- 除订单历史外，所有数据尽可能基于订单历史现场计算
- 手动操作需记录到 `otherLogs` 统一管理

## 许可证

本项目采用 WTFPL (Do What The Fuck You Want To Public License) 许可证，详见 [LICENSE](LICENSE) 文件。

## 免责声明

本软件按"原样"提供，不提供任何明示或暗示的担保。使用者需自行承担使用风险。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目。

## 联系方式

如有问题或建议，请通过项目 Issue 进行反馈。